# Exploiting a Vulnerable FTP Server

+ FTP (File Transfer Protocol) is a protocol that uses TCP port 21 and is used to facilitate file sharing between a server and client/clients.

+ It is also frequently used as a means of transferring files to and from the directory of a web server.

+ vsftpd is an FTP server for Unix-like systems including Linux systems and is the default FTP server for Ubuntu, CentOS and Fedora.

+ vsftpd V2.3.4 is vulnerable to a command execution vulnerability that is facilitated by a malicious backdoor that was added to the vsftpd download archive through a supply chain attack.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it vsftpd2.3.4 for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xls nmap result file.

**Note**: The target machine is the next ip after your ip address. If your ip is x.x.x.2, the target IP will be x.x.x.3.

- We already know there's only one module with the name vsftpd on it, so we can use the search command to look for it `search vsftpd` and we will find it. The module is `exploit/unix/ftp/vsftpd_234_backdoor`. By default, this module will use its own payload. Hit run and expect a shell session to be opened.

**Note**: Remember you can run `/bin/bash -i` and you will get a bash session.

- Now we are going to upgrade the shell session to a meterpreter session, and this can be achieved by using a post-exploitation module called `post/multi/manage/shell_to_meterpreter`. Here we need to consider we should already have access to the target system and an active session. We need to set the LHOST (we can specify the name of the interface name as well) and we need to specify the identifier of the session we want to upgrade. It could give you a little error but it should be fine. If we run `sessions` the session should be updated to a meterpreter session.

**Note**: uid=0 specifies the root user.
