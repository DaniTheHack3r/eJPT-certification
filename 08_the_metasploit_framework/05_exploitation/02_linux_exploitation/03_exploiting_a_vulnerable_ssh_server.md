# Exploiting A Vulnerable SSH Server

+ SSH (Secure Shell) is a remote administration protocol that offers encryption and is the successor to Telnet.

+ It is typically used for remote access to servers and systems.

+ SSH uses TCP port 22 by default, however, like other services, it can be configured to use any other open TCP port.

+ libssh is a multiplatform C library implementing the SSHv2 protocol on client and server side.

+ libssh V0.6.0-0.8.0 is vulnerable to an authentication bypass vulnerability in the libssh server code that can be exploited to execute commands on the target server.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it libssh for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xlm nmap result file.

**Note**: The target machine is the next ip after your ip address. If your ip is x.x.x.2, the target IP will be x.x.x.3.

- We are going to make a quick search for libssh auth bypass scanner in the msfconsole `search libssh_auth_bypass` and it should show the corresponding module `auxiliary/scanner/ssh/libssh_auth_bypass`. Check the options and pay special attention to the `SPAWN_PTY` option, which will allow us to spawn a terminal session, and set it to true. When it finishes, it should have spawned a shell session and you could see it by typing `sessions` in the msfconsole. This session will be a /bin/bash terminal.

**Note**: We can enumerate important information like kernel version `uname -r`, distro name and verison `cat /etc/*release` and user `whoami`.

- Now we are going to upgrade the shell session to a meterpreter session, and this can be achieved by using a post-exploitation module called `post/multi/manage/shell_to_meterpreter`. Here we need to consider we should already have access to the target system and an active session. We need to set the LHOST (we can specify the name of the interface name as well) and we need to specify the identifier of the session we want to upgrade. It could give you a little error but it should be fine. If we run `sessions` the session should be updated to a meterpreter session.

**Note**: uid=0 specifies the root user.
