# Linux Post Exploitation Modules

+ The MSF provides us with various post exploitation modules for both Windows and Linux.

+ We can utilize these post exploitation modules to enumerate information about the Linux system we currently have access to:
    - Enumerate system configuration
    - Enumerate environment variables
    - Enumerate network configuration
    - VM check
    - Enumerate user history

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it Linux_PE for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xlm nmap result file.

**Note**: The target machine is the next ip after your ip address. If your ip is x.x.x.2, the target IP will be x.x.x.3.

- We are going to start performing a quick search to see al exploit modules related to Samba `search type:exploit name:samba`. And we are going to pay attention to the module `exploit/linux/samba/is_known_pipename`. If we select the module, we only need to set up the RHOSTS, SMB_FOLER and SMB_SHARE_NAME. The module comes with its own payload by default, so there's no need to upgrade it.

**Note**: Remember you can run `/bin/bash -i` and you will get a bash session.

- To upgrade it to a meterpreter session run `sessions -u $SESSION_ID`.

- Let's try local enumeration on victim 2: `sysinfo`, `getuid`.

- Local enumeration from a /bin/bash shell: `cat /etc/passwd`, `cat /etc/*release`, `whoami`, `groups $USERNAME`, `cat /etc/*issue`, `uname -r`, `uname -a`, `ip a s`, `netstat -antp`, `ps aux`, `env`, 

- Enum config post exploitation module: `post/linux/gather/enum_configs` and set the SESSION. It will give us all config files in the system.

**Note**: You can revisit the information gathered from the `loot` command.

- Enum env variables post exploitation module: `post/linux/gather/env`.

- Enum network information post exploitation module: `post/linux/gather/enum_network`.

- Enum protections post exploitation module: `post/linux/gather/enum_protections`. Information like if system protection ASLR, SMEP, SMAP, Yama are enabled and if applications like iptables, tcpdump, wireshark are installed.

**Note**: This type of information can be revisited by running the command `notes`.

- Enum system information: `post/linux/gather/enum_system`.

- Check if the target is a container: `post/linux/gather/checkcontainer`. If we do this, we can perform a container breakout.

- Check if the target is VM: `post/linux/gather/checkvm`. If we do this, we can perform a VM breakout.

- Enum history file for all users in the machine: `post/linux/gather/enum_users_history`.
