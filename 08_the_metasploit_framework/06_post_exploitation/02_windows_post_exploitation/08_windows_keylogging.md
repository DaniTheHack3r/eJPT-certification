# Windows Keylogging

+ Keylogging is the process of recording or capturing the keystrokes entered on a target system.

+ This technique is not limited to post exploitation, there are plenty of programs and USB devices that can be used to capture and transmit the keystrokes entered on a system.

**Note**: This technique is also used by government agencies to spy or monitor individuals.

+ Meterpreter on a Windows system provides us with the ability to capture the keystrokes entered on a target system and download them back to our local system.

**Note**: Capturing keystrokes in a target machine could help us get passwords for other systems that can be exploited further on during the pentest.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it Keylogging for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xlm nmap result file.

- Service: BadBlue 2.7. Exploit found: `exploit/windows/http/badblue_passthru`. Get access to the target machine with a meterpreter session. Set the meterpreter, reverse_tcp payload, to the x64 version for windows. Remember to set the target to the appropiate target version.

- Let's try local enumeration: `sysinfo`, `getuid`, `getprivs`. Consider the user you are currently logged in at, it should be Administrator.

- Migrate to the explorer process to properly use the keylogging functionality of meterpreter as other processes could give you problems trying to capture keystrokes.

- Run `keyscan_start` from meterpreter and type something on a notepad in the target machine (you have access to the target machine).

- Run `keyscan_dump` to see the keystrokes captured.

**Note**: You could face some issues when using the keyscan utility. In that case run `keyscan_stop` and `keyscan_start` to restart it.
