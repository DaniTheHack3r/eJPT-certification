# Windows Privilege Escalation: Bypassing UAC

+ User Account Control (UAC) is a Windows security feature introduced in Windows Vista that is used to prevent unauthorized changes from being made to the operating system.

+ UAC is used to ensure that changes to the operating system require approval from the administrator.

+ We can utilize the “Windows Escalate UAC Protection Bypass (In Memory Injection)” module to bypass UAC by utilizing the trusted publisher certificate through process injection. It will spawn a second shell that has the UAC flag turned off.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it UACBypass for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xls nmap result file.

**Note**: The meterpreter session should be established previous to the use of UAC bypass (memory injection) and it should be an x64 meterpreter session.

- Service: Rejetto2.3. Exploit found: `exploit/windows/http/rejetto_hfs_exec`. Get access to the target machine with a meterpreter session. Set the meterpreter, reverse_tcp payload, to the x64 version for windows.

- Let's try local enumeration: `sysinfo`, `getuid`, `getprivs`. Consider the user you are currently logged in at.

- Let's try automatic privilege escalation: `getsystem`. It should fail in this case as it seems the user `admin` is not the Administrator. But it could still be part of the local administrators group.

- Pop a cmd prompt shell and run `net users` to see all local users. And `net localgroup administrators` to see if you are part of the local administrators group.

**Note**: UAC bypass is a reliable technique for privilege escalation as it exists from windows vista to the most recent versions of windows at the moment.

- Now we are going to use the `exploit/windows/local/bypassuac_injection` module on the meterpreter session we have running. Remember to set the correct options for the payload, and remember to set a x64 meterpreter payload and the TARGET to `Windows x64`.

- Now from the newly established meterpreter session, as UAC is now disabled thanks to the module, run `getsystem` and you should get NT AUTHORITY\SYSTEM privileges.

- To test your privileges, run `hashdump`.
