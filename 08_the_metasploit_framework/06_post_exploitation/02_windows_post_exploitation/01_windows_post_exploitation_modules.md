# Windows Post Exploitation Modules

+ The MSF provides us with various post exploitation modules for both Windows and Linux.

+ We can utilize these post exploitation modules to enumerate information about the Windows system we currently have access to:
    - Enumerate user privileges
    - Enumerate logged on users
    - VM check
    - Enumerate installed programs (Vulns in these programs can be used to elevate our privileges)
    - Enumerate AVs
    - Enumerate computers connected to domain (Useful for pivoting)
    - Enumerate installed patches (useful to get information about vulns inherent to the windows OS)
    - Enumerate shares

**Note**: From now on, the strategy for studying will change. Previously we used 1.5x, now we will use 2.0x in videos. And we will only take notes of really important things like: commands and advices from the teacher, descriptions of how to do the laboratories won't be written anymore.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it windows_post for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xls nmap result file.

- Service: Rejetto2.3. Exploit found: `exploit/windows/http/rejetto_hfs_exec`. Get access to the target machine with a meterpreter session.

- Local enumeration commands: `sysinfo`, `getuid`, `getprivs`.

**Note**: Check the help menu of meterpreter for windows.

- Privilege auto escalation command: `getsystem`. It could fail if no escalation techniques are found.

- Dumping has automatically: `hashdump`. It could fail if we don't have access to the SAM database.

- Drive enumeration: `show_mount`.

- Process list: `ps`.

- Process migration `migrate $PID`.

**Note**: We can run meterpreter as in previous lessons. Remember this is just an advanced cmd prompt version.

- There's an architecture migrate module in msfconsole: `post/windows/archmigrate`. And process migration: `post/windows/migrate`. It could fail if you already migrated to a x64 process.

- Privilege enumeration module: `post/windows/gather/win_privs`.

- Logged on users enumeration module: `post/windows/gather/enum_logged_on_users`. (useful if you want to be sure any other people can't see you logged on in the machine).

- Check if the target machine is a vm with the module: `post/windows/gather/checkvm`. (if yes, you could use VM breakout techniques and modules).

- Enumerate installed programs module: `post/windows/gather/enum_applications`. (Vulns in these programs can be used to elevate our privileges).

- Enumerate directories excluded from AV solutions with the module: `post/windows/gather/enum_av_excluded`. (useful to store things on disk without the av noticing).

- Enumerate other computers that are part of the domain with the module: `post/windows/gather/enum_computers`.

- Enumerate installed patches module: `post/windows/gather/enum_patches`. This could fail if you are in a process with a known bug in the WMI query. Try migrating to other processes in that case until you can get the information you want, consider that it is better if the process has NT AUTHORITY\SYSTEM privileges.

**Note**: If the previous module failed, we can switch to a manual approach by running shell from meterpreter and then `systeminfo` from the cmd prompt.

- Shares enumeration module: `post/windows/gather/enum_shares`.

- Check for RDP enabled with the module: `windows/manage/enable_rdp`. This is not a gather module, is a manage module, so it will try to enable RDP if it is not enable, and it will tell you if RDP is enabled already.

**Note**: All these pieces of information are stored as loot and can be reviewed with the command `loot` in the msfconsole.

**Note**: All these modules could be easily automated using resource scripts.
