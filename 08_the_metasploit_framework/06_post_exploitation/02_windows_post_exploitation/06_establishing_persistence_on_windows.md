# Establishing Persistence on Windows

+ Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access.

+ Gaining an initial foothold is not enough, you need to setup and maintain persistent access to your targets.

+ We can utilize various post exploitation persistence modules to ensure that we always have access to the target system.

## Laboratory

- Start the postgresql server by running `service postgresql start`.

- Start the msfconsole and check the database status.

- Create a new workspace and import your nmap scan results. We can name it Persistence for this example.

- Set globally the target IP with `setg RHOSTS $TARGET_IP`, do this for the RHOST option as well.

- We can start by using db_nmap to start scanning the target machine. Or you can import them from an external xlm nmap result file.

- Service: Rejetto2.3. Exploit found: `exploit/windows/http/rejetto_hfs_exec`. Get access to the target machine with a meterpreter session. Set the meterpreter, reverse_tcp payload, to the x64 version for windows.

- Let's try local enumeration: `sysinfo`, `getuid`, `getprivs`. Consider the user you are currently logged in at, it should be Administrator.

**Note**: It is important to have elevated privileges, like Administrator or NT AUTHORITY\SYSTEM, to establish persistence.

- Perform a quick search `search platform:windows presistence`. There are many ways to establish persistence but we will use `exploit/windows/local/persistence_service`. Remember to set the payload to 32bit meterpreter staged payload and the Session. It should start a new meterpreter session.

- Now kill all meterpreter sessions. Then select the multi/handler with LHOST and LPORT configured and it should start a meterpreter session right away as the persistence service should never stop sending connection requests.
