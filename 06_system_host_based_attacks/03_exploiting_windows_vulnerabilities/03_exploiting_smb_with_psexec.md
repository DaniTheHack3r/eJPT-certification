# Exploiting SMB With PsExec

## PsExec

PsExec is a lightweight telnet-replacement developed by Microsoft that allows you execute processes on remote windows systems using any user's credentials. We can use it to authenticate to the smb server and run arbitrary commands or launch a remote command prompt. It is similar to RDP but works through CMD instead of a GUI.

## Laboratory

1. Start with a regular nmap scan.

2. Now using the msf module `auxiliary/scanner/smb/smb_login`, we can pass a pass file and an user file to try to brute force credentials in the smb server. Once we have the credentials, we can use PsExec to exploit the SMB server.

**Note**: PsExec is a windows utility (.exe), so it cannot run natively in kali linux, however, we can run it using wine utility. Even though, there's a python implementation of the utility called psexec.py, which can be used in linux without any issue.

3. To run PsExec we use the following syntax: `psexec.py Administrator@<domain | target-ip>  <program-to-execute, i.e: cmd.exe>`.

**Note**: PsExec is a very effective exploitation technique as we are using legitimate microsoft technology to access the server, so it is less probably to be stopped or detected in most cases.

4. With msfconsole we can use a module called `exploit/windows/smb/psexec` that will connect using psexec to the target smb server using gathered credentials and start a meterpreter session for example (if we set it in the malicious payload).

**Note**: This method injects malicious payload into the target system, so you must consider that it can be detected by antivirus or IDS agents in the target system.

5. Flag retrieved: e0da81a9cd42b261bc9b90d15f780433.