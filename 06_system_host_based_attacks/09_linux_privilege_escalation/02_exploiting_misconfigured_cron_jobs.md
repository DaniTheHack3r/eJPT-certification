# Exploiting Misconfigured Cron Jobs

## Cron Jobs

- Linux implements task scheduling through a utility called Cron.

- Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specified schedule.

- An application, or script that has been configured to be run repeatedly with Cron is known as a Cron job. Cron can be used to automate or repeat a wide variety of functions on a system, from daily backups to system upgrades and patches.

- The crontab file is a configuration file that is used by the Cron utility to store and track Cron jobs that have been created.

## Exploiting Misconfigured Cron Jobs

- Cron jobs can also be run as any user on the system, this is a very important factor to keep an eye on as we will be targeting Cron jobs that have been configured to be run as the “root” user.

- This is primarily because, any script or command that is run by a Cron job will run as the root user and will consequently provide us with root access.

- In order to elevate our privileges, we will need to find and identify cron jobs scheduled by the root user or the files being processed by the cron job.

## Laboratory

- We will start this lab inside the target machine. We can perform some basic enumeration like `whoami` or `groups $USERNAME` to get some more information about the user we are logged in with. In this case the unprivileged user account is student. Try to check for cron jobs for that particular user running `crontab -l`.

**Note**: Exploiting these cron jobs would help us elevate our privileges without having to get access to the root user. If we are able to run shell code with sudo permissions, we are good to go.

**Note**: finding out what cron jobs were scheduled by the root user will require a big amount of enumeration and searching. By general rule, we would need to figure out created files that could potentialy be created or moved by a cron job, so we can try to grep the path of the file to see where it could lead.

- For this case, we were given a file called `message` inside the home directory of the student user. The main idea is to look for any occurrences of the complete path of the file, for example `/home/student/message` inside of any other shellcode existing around. So we will go to the root directory of the target system and execute a grep look up like this `grep -rnw /usr -e "/home/student/message"`. This command should actually give you an output that will point you to a shell code called `copy.sh`. This file actually contains a command that will copy the contents of the message to the tmp directory, so you can go and try to read the file `message` from there.

- Now, we will focus on the copy.sh shell code. This script file has an issue, if you list the contents of the directory containing the file to check its permissions, you will notice that all users on the machine have read/write/exec permissions over that file.

**Note**: We don't want to execute the shellcode by ourselves, because we want it to be excuted with sudo permissions. For that we need to wait for the cron job to run. We could actually run a command to add us to the root group or give us sudo permissions by adding us to the sudoers file. Or change the root password if we want that.

- As we don't have any text editors in this lab environment, we will have to make use of an ingenous technique. We will run for that a command called `printf` like this `printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh`. This will help us insert a new command into the copy.sh file that will append our user student to the file sudoers with all permissions with no password.

- Now we want a minute to check that the cron has done its job by running `sudo -l` which will list our permissions as a new sudo user. Now we can run any root privilege level command like for example `sudo su` that will give us access to the root account. If we run `whoami` we'll see that we are the root account after running sudo su. If we take a look, being the root user, at the crontab by running `crontab -l` we can see the cron jobs made by the user root.

Flag: 697914df7a07bb9b718c8ed258150164
