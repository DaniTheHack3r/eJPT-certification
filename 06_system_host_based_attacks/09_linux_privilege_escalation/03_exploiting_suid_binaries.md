# Exploiting SUID Binaries

- In addition to the three main file access permissions (read, write and execute), Linux also provides users with specialized permissions that can be utilized in specific situations. One of these access permissions is the SUID (Set Owner User ID) permission.

- When applied, this permission provides users with the ability to execute a script or binary with the permissions of the file owner as opposed to the user that is running the script or binary.

- SUID permissions are typically used to provide unprivileged users with the ability to run specific scripts or binaries with “root” permissions. It is to be noted, however, that the provision of elevate privileges is limited to the execution of the script and does not translate to elevation of privileges, however, if improperly configured unprivileged users can exploit misconfigurations or vulnerabilities within the binary or script to obtain an elevated session.

- This is the functionality that we will be attempting to exploit in order to elevate our privileges, however, the success of our attack will depend on the following factors:
    + Owner of the SUID binary – Given that we are attempting to elevate our privileges, we will only be exploiting SUID binaries that are owned by the “root” user or other privileged users.
    + Access permissions – We will require executable permissions in order to execute the SUID binary.

## Laboratory

We will start this lab inside the target machine. We can perform some basic enumeration like `whoami` or `groups $USERNAME` to get some more information about the user we are logged in with.

- Let's start by checking the home directory, we will find two binaries. One called greetings and the other one called welcome. Pay special attention to the one called welcome, if you look at the owner permissions, there is an s instead of a x where execution permission should be. That means that an SUID permission. Let's check the first file called greetings, if you try to run it, you will see that you don't have permissions to run it. But if you try instead the welcome binary, you will execute with root permissions instead of your own permissions.

- Now let's check the type of the file, if we run `file welcome`, you will see more info about the file. You can even see what shared files are consume by the binary.

**Note**: if you, for any reason, find there are some shared objects missing, you could create your own shared objects in order to exploit the SUID permission given to the binary.

- As there are no missing shared objects, we cannot delete the one we found and create it again as we are not the root user. So we can then try to use the command strings to find strings inside the binary. If we take a close look at this static enumeration of the file, we can see that the file is calling the shared object, but further down, is also calling greetings binary so what if we create or edit the greetings binary and we make it run bash or a reverse shell. So let's try it delete the greetings file so you can create another one.

- In order to make greetings initialize bash when called during welcome execution, we can just copy the /bin/bash binary into our home and rename it greetings like this `cp /bin/bash greetings`. Doing this, if we now run the welcome binary, we should be able to obtain a bash session as root, that is, with elevated privileges. You can verify current privileges by running `whoami` or `id`. Both should be root.

Flag: b92bcdc876d52108778e2d81f3b01494
